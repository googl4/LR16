MAIN:
	LDI r0, 0x5555
	CALL SCREENFILL
	
MAIN_LOOP:
	CALL VBLANKWAIT
	LDI r0, 50
	LDI r1, 60
	LDI r2, 0x6666
	CALL PLOT
	JMP LOOP


SCREENFILL:
	LDI r1, 0xA0
	LDS r1, s0
	LDI r2, 0xFA00
	LDI r3, SCREENFILL_LOOP
	XOR r4, r4

SCREENFILL_LOOP:
	STR r0, [s0:r4+]
	STR r0, [s0:r4+]
	STR r0, [s0:r4+]
	STR r0, [s0:r4+]
	SLT r5, r4, r2
	JNZ r3, r5
	
	RET


PLOT:
	LDI r3, 0xA0
	LDS r3, s0
	LDI r4, 320
	MUL r4, r1
	ADD r4, r0
	STR r2, [s0:r4]
	RET


VBLANKWAIT:
	LDI r0, 0xC0
	LDS r0, s0
	XOR r0, r0
	LDI r1, VBLANKWAIT_RETURN
	
VBLANKWAIT_LOOP:
	LDR r2, [s0:r0]
	AND r2, 1
	JNZ r1, r2
	JMP VBLANKWAIT_LOOP
	
VBLANKWAIT_RETURN:
	RET
